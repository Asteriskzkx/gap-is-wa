## แผนการทดสอบการเรียกดูรายงาน (Playwright E2E Testing)

ขอบเขตหน้างาน:

- `src/app/admin/report/page.tsx`
- `src/app/auditor/report/page.tsx`
- `src/app/committee/report/page.tsx`

เงื่อนไข/ข้อมูลทดสอบร่วม (สำหรับ Playwright E2E):

- มีผู้ใช้ทดสอบอย่างน้อย 3 บทบาท: `ADMIN`, `AUDITOR`, `COMMITTEE`
- สามารถเข้าสู่ระบบใน E2E ได้ (ผ่าน UI หรือ state ที่โปรเจกต์รองรับ)
- ช่วงวันที่ทดสอบตัวอย่าง: `2025-01-01` ถึง `2025-12-31` (ปรับตามข้อมูล seed จริงได้)
- กรณีที่ต้องการควบคุมข้อมูล/สถานะ (empty/error) ให้ใช้การ mock network ของ Playwright (`page.route`) กับ API ต่อไปนี้:
  - Admin: `/api/v1/reports/users`, `/api/v1/reports/users/new-users`, `/api/v1/reports/inspections`, `/api/v1/reports/rubber-farms`, `/api/v1/reports/certificates`, `/api/v1/reports/auditors`
  - Auditor: `/api/v1/reports/auditor/my-report`
  - Committee: `/api/v1/reports/committee`

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                                                    | ขั้นตอนการทดสอบ                                                                                                  | ข้อมูลการทดสอบ                                                                                          | ค่าคาดหวัง                                                                                                    |
| ------------- | ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| TC-001        | เข้าหน้ารายงานผู้ดูแลระบบได้ (Admin)                                                | 1) Login เป็น ADMIN 2) เปิดหน้า `/admin/report`                                                                  | ผู้ใช้บทบาท ADMIN                                                                                       | แสดงหน้า “รายงานระบบ” และโหลดข้อมูลสำเร็จ (ไม่มี error/crash)                                                 |
| TC-002        | ป้องกันการเข้าหน้ารายงานผู้ดูแลระบบจากบทบาทอื่น                                     | 1) Login เป็น AUDITOR หรือ COMMITTEE 2) เปิดหน้า `/admin/report`                                                 | ผู้ใช้บทบาท AUDITOR/COMMITTEE                                                                           | ไม่สามารถเข้าถึงหน้าได้ (ถูก redirect/ขึ้นข้อความไม่อนุญาต ตามพฤติกรรมระบบ)                                   |
| TC-003        | เข้าหน้ารายงานผู้ตรวจ (Auditor) ได้                                                 | 1) Login เป็น AUDITOR 2) เปิดหน้า `/auditor/report`                                                              | ผู้ใช้บทบาท AUDITOR                                                                                     | แสดงหัวข้อ “รายงานสถิติการตรวจ” และมีปุ่ม “ส่งออก PDF”                                                        |
| TC-004        | ป้องกันการเข้าหน้ารายงานผู้ตรวจจากบทบาทอื่น                                         | 1) Login เป็น ADMIN หรือ COMMITTEE 2) เปิดหน้า `/auditor/report`                                                 | ผู้ใช้บทบาท ADMIN/COMMITTEE                                                                             | ไม่สามารถเข้าถึงหน้าได้ (redirect/ไม่อนุญาต ตามพฤติกรรมระบบ)                                                  |
| TC-005        | เข้าหน้ารายงานคณะกรรมการ (Committee) ได้                                            | 1) Login เป็น COMMITTEE 2) เปิดหน้า `/committee/report`                                                          | ผู้ใช้บทบาท COMMITTEE                                                                                   | แสดงหน้า “รายงานคณะกรรมการ” และโหลดข้อมูลสำเร็จ                                                               |
| TC-006        | ป้องกันการเข้าหน้ารายงานคณะกรรมการจากบทบาทอื่น                                      | 1) Login เป็น ADMIN หรือ AUDITOR 2) เปิดหน้า `/committee/report`                                                 | ผู้ใช้บทบาท ADMIN/AUDITOR                                                                               | ไม่สามารถเข้าถึงหน้าได้ (redirect/ไม่อนุญาต ตามพฤติกรรมระบบ)                                                  |
| TC-007        | Admin: เปลี่ยนช่วงวันที่แล้วเรียก API พร้อม query params                            | 1) Login ADMIN 2) เปิด `/admin/report` 3) เลือกช่วงวันที่ใน Calendar 4) รอ network                               | ช่วงวันที่ 2025-01-01 ถึง 2025-12-31                                                                    | มีการเรียก API รายงานของ Admin ด้วย `startDate` และ `endDate` ใน query string                                 |
| TC-008        | Admin: ล้างวันที่ (Clear dates) แล้วกลับสู่ค่าเริ่มต้น                              | 1) ตั้งช่วงวันที่ 2) กดปุ่ม “ล้างวันที่”                                                                         | ช่วงวันที่ใดก็ได้                                                                                       | Calendar ถูกล้างค่า และมีการเรียก API แบบไม่มี `startDate/endDate` (หรือข้อมูลกลับสู่ base state)             |
| TC-009        | Admin: เปิด/ปิดหน้าต่างส่งออก PDF ได้                                               | 1) เปิด `/admin/report` 2) กด “ส่งออก PDF” 3) กด “ยกเลิก”                                                        | ADMIN                                                                                                   | Dialog ส่งออก PDF เปิดขึ้น และปิดได้โดยไม่กระทบหน้า                                                           |
| TC-010        | Admin: ปุ่มส่งออก PDF ถูก disable เมื่อไม่เลือก section ใดๆ                         | 1) เปิด Dialog ส่งออก 2) เอาเครื่องหมายออกทุก checkbox 3) ตรวจปุ่ม “ส่งออก PDF”                                  | ADMIN                                                                                                   | ปุ่ม “ส่งออก PDF” เป็น disabled เมื่อไม่มี section ถูกเลือก                                                   |
| TC-011        | Admin: เลือกทั้งหมด (Select all) คุม checkbox ทุกอัน                                | 1) เปิด Dialog ส่งออก 2) คลิก “✅ เลือกทั้งหมด” ให้เป็น checked 3) คลิกซ้ำเพื่อ uncheck                          | ADMIN                                                                                                   | checkbox รายการทั้งหมดถูกเลือก/ยกเลิกพร้อมกัน และปุ่มส่งออก enable เมื่อมีอย่างน้อย 1 รายการถูกเลือก          |
| TC-012        | Admin: ส่งออก PDF แล้วมีไฟล์ถูกดาวน์โหลด                                            | 1) เปิด Dialog ส่งออก 2) เลือกอย่างน้อย 1 section 3) กด “ส่งออก PDF” 4) รอ download event                        | ADMIN                                                                                                   | มีไฟล์ดาวน์โหลดชื่อขึ้นต้น `รายงานระบบ_` และนามสกุล `.pdf`                                                    |
| TC-013        | Auditor: เปลี่ยนช่วงวันที่แล้วข้อมูลรายงานถูกรีเฟรช                                 | 1) Login AUDITOR 2) เปิด `/auditor/report` 3) เลือกช่วงวันที่ 4) รอ network                                      | ช่วงวันที่ 2025-01-01 ถึง 2025-12-31                                                                    | มีการเรียก `/api/v1/reports/auditor/my-report?startDate=...&endDate=...` และหน้าไม่ error                     |
| TC-014        | Auditor: ล้างวันที่แล้วข้อมูลกลับสู่ค่าเริ่มต้น                                     | 1) ตั้งช่วงวันที่ 2) กด “ล้างวันที่”                                                                             | AUDITOR                                                                                                 | Calendar ถูกล้างค่า และมีการเรียก endpoint แบบไม่มี query params                                              |
| TC-015        | Auditor: ตาราง “แปลงยางที่ตรวจแล้ว” ดูเพิ่มเติม/แสดงน้อยลง                          | 1) เปิด `/auditor/report` 2) (ถ้ามีปุ่ม) กด “ดูเพิ่มเติม (...) แปลง” 3) ตรวจจำนวนแถวเพิ่มขึ้น 4) กด “แสดงน้อยลง” | AUDITOR + ต้องมีข้อมูล `inspectedFarms` มากกว่า 5 รายการ (หรือ mock)                                    | จำนวนรายการที่แสดงเพิ่มขึ้นเมื่อกดดูเพิ่มเติม และกลับไป 5 รายการเมื่อกดแสดงน้อยลง                             |
| TC-016        | Auditor: ส่งออก PDF แล้วมีไฟล์ถูกดาวน์โหลด                                          | 1) เปิด Dialog ส่งออก 2) เลือก section อย่างน้อย 1 3) กด “ส่งออก PDF” 4) รอ download event                       | AUDITOR                                                                                                 | มีไฟล์ดาวน์โหลดชื่อขึ้นต้น `รายงานการตรวจ_` และนามสกุล `.pdf`                                                 |
| TC-017        | Committee: หน้าโหลด base report ก่อน และแสดงกราฟ/สรุป                               | 1) Login COMMITTEE 2) เปิด `/committee/report` 3) รอโหลด                                                         | COMMITTEE                                                                                               | มีการเรียก `/api/v1/reports/committee` (base) และ render องค์ประกอบรายงานโดยไม่ crash                         |
| TC-018        | Committee: เลือกช่วงวันที่แล้วเรียก API committee พร้อม query params (chart filter) | 1) เปิด `/committee/report` 2) เลือกช่วงวันที่ใน Calendar 3) รอ network                                          | ช่วงวันที่ 2025-01-01 ถึง 2025-12-31                                                                    | มีการเรียก `/api/v1/reports/committee?startDate=...&endDate=...` และกราฟ/สรุปส่วนที่เกี่ยวกับการตรวจถูกรีเฟรช |
| TC-019        | Committee: ล้างวันที่แล้วกลับสู่ base state                                         | 1) ตั้งช่วงวันที่ 2) กด “ล้างวันที่”                                                                             | COMMITTEE                                                                                               | Calendar ถูกล้างค่า และข้อมูลกลับไปอิง base report (ไม่มี query params)                                       |
| TC-020        | Committee: ส่งออก PDF แล้วมีไฟล์ถูกดาวน์โหลด                                        | 1) เปิด Dialog ส่งออก 2) เลือก section อย่างน้อย 1 3) กด “ส่งออก PDF” 4) รอ download event                       | COMMITTEE                                                                                               | มีไฟล์ดาวน์โหลดชื่อขึ้นต้น `รายงานคณะกรรมการ_` และนามสกุล `.pdf`                                              |
| TC-021        | Committee: กรณีข้อมูลกราฟว่าง แสดง “ไม่มีข้อมูล”                                    | 1) Mock `/api/v1/reports/committee` ให้ค่าที่ทำให้กราฟเป็น 0 ทั้งหมด 2) เปิด `/committee/report`                 | Mock response ที่ `activeCertificates/expiredCertificates/cancelRequested` เป็น 0 และ/หรือ stats เป็น 0 | ในกราฟมี label “ไม่มีข้อมูล” (หรือ state ว่างตามที่ UI แสดง) และหน้าไม่พัง                                    |
