# แผนการทดสอบบันทึกการให้คำปรึกษาและข้อบกพร่อง (Playwright E2E Testing)

เอกสารนี้ครอบคลุมเฉพาะพฤติกรรมที่ทดสอบได้ด้วย Playwright E2E ของหน้า “บันทึกการให้คำปรึกษาและข้อบกพร่อง” เท่านั้น

- ไม่ทดสอบเชิง internal เช่น payload/DB/console/CSS-only
- กรณีที่ต้องควบคุมข้อมูล แนะนำใช้ seed data หรือ `page.route()` เพื่อ mock API

## Step 1: เลือกการตรวจประเมิน

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                          | ขั้นตอนการทดสอบ                                                                                    | ข้อมูลการทดสอบ                                             | ค่าคาดหวัง                                                                                                           |
| ------------- | ----------------------------------------- | -------------------------------------------------------------------------------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| TC-001        | ต้อง login ก่อนใช้งานหน้า                 | 1. เข้าหน้าโดยไม่มี session (logout)<br>2. เปิดหน้า “บันทึกการให้คำปรึกษาและข้อบกพร่อง”            | ไม่ได้ login                                               | ถูก redirect ไปหน้า `/`                                                                                              |
| TC-002        | แสดงชื่อหน้าและคำอธิบาย                   | 1. Login เป็น Auditor<br>2. เข้าหน้า “บันทึกการให้คำปรึกษาและข้อบกพร่อง”                           | -                                                          | แสดงหัวข้อ “บันทึกการให้คำปรึกษาและข้อบกพร่อง” และคำอธิบาย “บันทึกรายละเอียดคำแนะนำและข้อบกพร่องที่พบระหว่างการตรวจ” |
| TC-003        | StepIndicator แสดง Step 1                 | 1. เข้าหน้า<br>2. ตรวจสอบ StepIndicator                                                            | -                                                          | แสดง 2 steps: “เลือกการตรวจประเมิน”, “บันทึกการให้คำปรึกษาและข้อบกพร่อง” และอยู่ที่ step 1                           |
| TC-004        | แสดงแท็บสถานะ 2 ปุ่ม                      | 1. อยู่ Step 1                                                                                     | -                                                          | แสดงปุ่ม “อยู่ระหว่างการตรวจประเมิน” และ “ตรวจประเมินเสร็จแล้ว”                                                      |
| TC-005        | แสดงตัวกรอง Location 3 ช่อง               | 1. อยู่ Step 1                                                                                     | -                                                          | แสดงช่อง “จังหวัด”, “อำเภอ/เขต”, “ตำบล/แขวง” พร้อมปุ่ม “ค้นหา” และ “ล้างค่า”                                         |
| TC-006        | อำเภอ/เขต disabled จนกว่าจะเลือกจังหวัด   | 1. อยู่ Step 1<br>2. ตรวจสอบสถานะช่อง “อำเภอ/เขต”                                                  | ยังไม่เลือกจังหวัด                                         | ช่อง “อำเภอ/เขต” ถูก disabled                                                                                        |
| TC-007        | ตำบล/แขวง disabled จนกว่าจะเลือกอำเภอ     | 1. เลือกจังหวัดใดๆ<br>2. ตรวจสอบสถานะช่อง “ตำบล/แขวง”                                              | เลือกจังหวัดแล้ว แต่ยังไม่เลือกอำเภอ                       | ช่อง “ตำบล/แขวง” ถูก disabled                                                                                        |
| TC-008        | เลือกจังหวัดแล้ว enable อำเภอ/เขต         | 1. เลือกจังหวัดใดๆ                                                                                 | จังหวัดที่มีอำเภอ                                          | ช่อง “อำเภอ/เขต” enabled และมีตัวเลือก                                                                               |
| TC-009        | เลือกอำเภอแล้ว enable ตำบล/แขวง           | 1. เลือกจังหวัด<br>2. เลือกอำเภอ/เขต                                                               | อำเภอที่มีตำบล                                             | ช่อง “ตำบล/แขวง” enabled และมีตัวเลือก                                                                               |
| TC-010        | เปลี่ยนจังหวัดแล้วรีเซ็ตอำเภอ/ตำบล        | 1. เลือกจังหวัด/อำเภอ/ตำบล<br>2. เปลี่ยนจังหวัด                                                    | -                                                          | ค่า “อำเภอ/เขต” และ “ตำบล/แขวง” ถูกรีเซ็ตเป็นว่าง                                                                    |
| TC-011        | เปลี่ยนอำเภอแล้วรีเซ็ตตำบล                | 1. เลือกจังหวัด/อำเภอ/ตำบล<br>2. เปลี่ยนอำเภอ/เขต                                                  | -                                                          | ค่า “ตำบล/แขวง” ถูกรีเซ็ตเป็นว่าง                                                                                    |
| TC-012        | กด “ค้นหา” แล้วรายการเปลี่ยนตามตัวกรอง    | 1. เลือกจังหวัด/อำเภอ/ตำบล อย่างน้อย 1 ค่า<br>2. กด “ค้นหา”                                        | mock/seed ให้มีทั้ง match และไม่ match                     | ตารางแสดงรายการที่สอดคล้องกับตัวกรอง (ตรวจจากผลลัพธ์บนตาราง)                                                         |
| TC-013        | กด “ล้างค่า” รีเซ็ตตัวกรองทั้งหมด         | 1. เลือกค่าในตัวกรองอย่างน้อย 1 ค่า<br>2. กด “ล้างค่า”                                             | -                                                          | จังหวัด/อำเภอ/ตำบล ถูกล้างทั้งหมด และรายการกลับเป็นชุดเริ่มต้น                                                       |
| TC-014        | แสดงตาราง 5 คอลัมน์ตาม UI จริง            | 1. อยู่ Step 1<br>2. ตรวจสอบหัวคอลัมน์ในตาราง                                                      | -                                                          | แสดงหัวคอลัมน์: “รหัสการตรวจ”, “วันที่ตรวจ”, “ประเภท”, “สถานที่”, “เกษตรกร”                                          |
| TC-015        | วันที่ตรวจแสดงเป็นรูปแบบไทยเมื่อมีค่า     | 1. เปิดรายการที่มี “วันที่ตรวจ”<br>2. ตรวจสอบ cell วันที่                                          | มี `inspectionDateAndTime`                                 | แสดงวันที่แบบ `th-TH` (เช่น เดือนแบบย่อ)                                                                             |
| TC-016        | วันที่ตรวจเป็น “-” เมื่อไม่มีค่า          | 1. เปิดรายการที่ไม่มี “วันที่ตรวจ”                                                                 | `inspectionDateAndTime` เป็น null/undefined                | แสดง “-”                                                                                                             |
| TC-017        | สถานที่แสดงจากข้อมูลที่มี                 | 1. เปิดรายการที่มีข้อมูลสถานที่บางส่วน/ครบ<br>2. ตรวจสอบคอลัมน์ “สถานที่”                          | มี `villageName/subDistrict/district/province` บางส่วน/ครบ | แสดงข้อความต่อกันด้วยช่องว่าง และถ้าไม่มีทั้งหมดให้แสดง “-”                                                          |
| TC-018        | เกษตรกรแสดง “ไม่ระบุ” เมื่อไม่มีข้อมูล    | 1. เปิดรายการที่ไม่มี `rubberFarm.farmer`                                                          | farmer missing                                             | แสดง “ไม่ระบุ”                                                                                                       |
| TC-019        | Pagination ไปหน้าถัดไปได้                 | 1. มีข้อมูลมากกว่า 10 รายการ<br>2. กดไปหน้าถัดไปของ paginator                                      | seed/mock > 10                                             | ตารางเปลี่ยนชุดข้อมูลตามหน้าที่เลือก                                                                                 |
| TC-020        | เปลี่ยนจำนวนรายการต่อหน้า (25)            | 1. เปลี่ยน rows per page เป็น 25                                                                   | seed/mock >= 25                                            | ตารางแสดงจำนวนแถวตามที่เลือก                                                                                         |
| TC-021        | Sort คอลัมน์ “รหัสการตรวจ”                | 1. คลิกหัวคอลัมน์ “รหัสการตรวจ” เพื่อ sort                                                         | seed/mock ให้เห็นผลเรียง                                   | ลำดับแถวเปลี่ยนตามการ sort (ตรวจจากค่าบนตาราง)                                                                       |
| TC-022        | Multi-sort บนตาราง                        | 1. Sort “รหัสการตรวจ”<br>2. เพิ่ม sort อีกคอลัมน์ เช่น “ประเภท” (ตามวิธี multi-sort ของ DataTable) | seed/mock ให้เห็นผล                                        | ลำดับแถวเปลี่ยนตาม multi-sort                                                                                        |
| TC-023        | สลับแท็บแล้วล้างการเลือกแถว               | 1. คลิกเลือก 1 แถวในตาราง<br>2. สลับแท็บ “อยู่ระหว่างการตรวจประเมิน”/“ตรวจประเมินเสร็จแล้ว”        | seed/mock มีข้อมูลทั้ง 2 แท็บ                              | ปุ่ม “ถัดไป” กลับเป็น disabled (เพราะการเลือกถูกล้าง)                                                                |
| TC-024        | ปุ่ม “ถัดไป” disabled เมื่อยังไม่เลือกแถว | 1. อยู่ Step 1                                                                                     | -                                                          | ปุ่ม “ถัดไป” disabled                                                                                                |
| TC-025        | เลือกแถวแล้ว “ถัดไป” enabled              | 1. คลิกเลือกแถวหนึ่งในตาราง                                                                        | มีอย่างน้อย 1 แถว                                          | ปุ่ม “ถัดไป” enabled                                                                                                 |
| TC-026        | กด “ถัดไป” ไป Step 2                      | 1. เลือกแถว<br>2. กด “ถัดไป”                                                                       | -                                                          | แสดง Step 2 และ StepIndicator อยู่ที่ step 2                                                                         |

## Step 2: บันทึกการให้คำปรึกษาและข้อบกพร่อง

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                   | ขั้นตอนการทดสอบ                                                                                       | ข้อมูลการทดสอบ                                      | ค่าคาดหวัง                                                                |
| ------------- | -------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | --------------------------------------------------- | ------------------------------------------------------------------------- |
| TC-027        | แสดงช่อง “วันที่บันทึกข้อมูล”                      | 1. ไป Step 2                                                                                          | -                                                   | แสดง label “วันที่บันทึกข้อมูล” และ placeholder “เลือกวันที่บันทึกข้อมูล” |
| TC-028        | เลือกวันที่บันทึกข้อมูลได้                         | 1. ไป Step 2<br>2. เลือกวันที่ใน calendar                                                             | -                                                   | ค่าในช่อง “วันที่บันทึกข้อมูล” เปลี่ยนตามวันที่ที่เลือก                   |
| TC-029        | แสดง Section 1 (คำปรึกษา) และมี 1 รายการเริ่มต้น   | 1. ไป Step 2                                                                                          | -                                                   | แสดงหัวข้อ “1. แบบบันทึกคำแนะนำการให้คำปรึกษา” และมีชุด input 1 รายการ    |
| TC-030        | เพิ่มรายการคำปรึกษา                                | 1. ไป Step 2<br>2. กด “เพิ่มรายการคำปรึกษา”                                                           | -                                                   | จำนวนรายการคำปรึกษาเพิ่มขึ้น 1                                            |
| TC-031        | ปุ่ม “ลบรายการ” แสดงเมื่อมีมากกว่า 1               | 1. เพิ่มรายการคำปรึกษาให้มีอย่างน้อย 2 รายการ                                                         | -                                                   | เห็นปุ่ม “ลบรายการ” ในแต่ละรายการคำปรึกษา                                 |
| TC-032        | ลบรายการคำปรึกษา                                   | 1. มีรายการคำปรึกษาอย่างน้อย 2 รายการ<br>2. กด “ลบรายการ” ของรายการหนึ่ง                              | -                                                   | รายการนั้นถูกลบออก และจำนวนรายการลดลง                                     |
| TC-033        | กรอกฟิลด์คำปรึกษาได้ครบ                            | 1. กรอก “รายการให้คำปรึกษา”<br>2. กรอก “แนวทางการแก้ไข”<br>3. เลือก “กำหนดระยะเวลา”                   | -                                                   | ค่าที่กรอก/เลือกถูกแสดงใน input ของรายการนั้น                             |
| TC-034        | แสดง Section 2 (ข้อบกพร่อง) และมี 1 รายการเริ่มต้น | 1. ไป Step 2                                                                                          | -                                                   | แสดงหัวข้อ “2. แบบบันทึกข้อบกพร่อง” และมีชุด input 1 รายการ               |
| TC-035        | เพิ่มรายการข้อบกพร่อง                              | 1. ไป Step 2<br>2. กด “เพิ่มรายการข้อบกพร่อง”                                                         | -                                                   | จำนวนรายการข้อบกพร่องเพิ่มขึ้น 1                                          |
| TC-036        | ปุ่ม “ลบรายการ” ของข้อบกพร่องแสดงเมื่อมีมากกว่า 1  | 1. เพิ่มรายการข้อบกพร่องให้มีอย่างน้อย 2 รายการ                                                       | -                                                   | เห็นปุ่ม “ลบรายการ” ในแต่ละรายการข้อบกพร่อง                               |
| TC-037        | ลบรายการข้อบกพร่อง                                 | 1. มีรายการข้อบกพร่องอย่างน้อย 2 รายการ<br>2. กด “ลบรายการ” ของรายการหนึ่ง                            | -                                                   | รายการนั้นถูกลบออก และจำนวนรายการลดลง                                     |
| TC-038        | กรอกฟิลด์ข้อบกพร่องได้ครบ                          | 1. กรอก “ข้อบกพร่องที่พบ”<br>2. กรอก “รายละเอียดข้อบกพร่อง”<br>3. เลือก “กำหนดระยะเวลาแก้ไข”          | -                                                   | ค่าที่กรอก/เลือกถูกแสดงใน input ของรายการนั้น                             |
| TC-039        | ปุ่ม “ย้อนกลับ” กลับไป Step 1                      | 1. อยู่ Step 2<br>2. กด “ย้อนกลับ”                                                                    | -                                                   | กลับไป Step 1 และยังคงมีแถวที่เลือกอยู่ ทำให้ “ถัดไป” enabled             |
| TC-040        | บันทึกสำเร็จ (มีข้อมูลเดิม)                        | 1. เลือก inspection ที่มี `adviceAndDefect`<br>2. ไป Step 2<br>3. แก้ไขข้อมูล<br>4. กด “บันทึกข้อมูล” | mock PUT `/api/v1/advice-and-defects/:id` ให้สำเร็จ | แสดง toast success “บันทึกข้อมูลเรียบร้อย”                                |
| TC-041        | บันทึกไม่สำเร็จแสดงข้อความจาก server               | 1. ไป Step 2<br>2. กด “บันทึกข้อมูล”                                                                  | mock API ให้ตอบ error และส่ง `{ message: "..." }`   | แสดง toast error ตาม `message` จาก server                                 |
| TC-042        | บันทึกไม่สำเร็จ fallback message                   | 1. ไป Step 2<br>2. กด “บันทึกข้อมูล”                                                                  | mock ให้ error ไม่มี `message`                      | แสดง toast error “บันทึกข้อมูลไม่สำเร็จ”                                  |
