# แผนการทดสอบยกเลิกใบรับรองแหล่งผลิตจีเอพี (Playwright E2E Testing)

เอกสารนี้เก็บเฉพาะกรณีที่ทดสอบได้ด้วย Playwright แบบ End-to-End โดยยึด UI จริงจากหน้า `src/app/committee/certifications/revoke/page.tsx` และพฤติกรรม toast จาก `src/hooks/useRevokeCertificate.ts`

**ขอบเขต**

- ตรวจเฉพาะสิ่งที่ผู้ใช้มองเห็น/โต้ตอบได้: ข้อความบนจอ, ปุ่ม enabled/disabled, การเปลี่ยน step, การเปิดแท็บไฟล์, toast
- ไม่ตรวจ: payload/body, DB state, internal state, console log, CSS/responsive/pixel-perfect
- แนะนำให้ mock API ด้วย `page.route(...)` เพื่อทำให้ผลลัพธ์ deterministic

---

## Step 1: เลือกใบรับรอง

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                        | ขั้นตอนการทดสอบ                                                 | ข้อมูลการทดสอบ                          | ค่าคาดหวัง                                                                                             |
| ------------- | --------------------------------------- | --------------------------------------------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| TC-001        | เข้าได้เฉพาะผู้ใช้ที่ login             | 1) เปิดหน้า `/committee/certifications/revoke` โดยไม่มี session | ไม่ล็อกอิน                              | ระบบ redirect ไปหน้า `/`                                                                               |
| TC-002        | แสดงหัวข้อ/คำอธิบายหน้าถูกต้อง          | 1) Login เป็น committee 2) เปิดหน้า                             | บัญชี Committee                         | เห็นข้อความ “ยกเลิกใบรับรองแหล่งผลิตจีเอพี” และ “ยกเลิกใบรับรองแหล่งผลิตยางพาราที่มีคำขอยกเลิก”        |
| TC-003        | แสดง Step indicator และอยู่ที่ Step 1   | 1) เปิดหน้า                                                     | อยู่หน้า Step 1                         | เห็น step “เลือกใบรับรอง” และ “ยกเลิกใบรับรอง” และ UI อยู่ใน Step 1                                    |
| TC-004        | แสดงตัวกรองวันที่และปุ่มค้นหา/ล้างค่า   | 1) เปิดหน้า                                                     | อยู่หน้า Step 1                         | เห็น label “ตั้งแต่/ถึง”, placeholder “เลือกวันที่มีผล/เลือกวันที่หมดอายุ”, ปุ่ม “ค้นหา” และ “ล้างค่า” |
| TC-005        | แสดงปุ่มแท็บ 2 แบบ                      | 1) เปิดหน้า                                                     | อยู่หน้า Step 1                         | เห็นปุ่ม “ใบรับรองที่มีคำขอยกเลิก” และ “ใบรับรองที่ไม่มีคำขอยกเลิก”                                    |
| TC-006        | แสดงตารางรายการพร้อมคอลัมน์หลัก         | 1) เปิดหน้า (มีข้อมูลอย่างน้อย 1 แถว)                           | มีข้อมูลอย่างน้อย 1 แถว                 | เห็นหัวคอลัมน์: “รหัสใบรับรอง”, “รหัสการตรวจ”, “วันที่ตรวจ”, “สถานที่”, “วันที่มีผล”, “วันที่หมดอายุ”  |
| TC-007        | ปุ่ม “ถัดไป” ถูกปิดก่อนเลือกแถว         | 1) เปิดหน้า 2) ไม่เลือกแถว                                      | ยังไม่เลือกแถว                          | ปุ่ม “ถัดไป” disabled                                                                                  |
| TC-008        | เลือกแถวแล้ว “ถัดไป” ใช้งานได้          | 1) คลิกเลือกแถวใดแถวหนึ่ง                                       | เลือกแถวแรก                             | ปุ่ม “ถัดไป” enabled                                                                                   |
| TC-009        | กด “ถัดไป” ไป Step 2                    | 1) เลือกแถว 2) กด “ถัดไป”                                       | เลือกแถวแรก                             | ไป Step 2 และเห็นหัวข้อ “รายละเอียดคำขอยกเลิกใบรับรอง”                                                 |
| TC-010        | เปลี่ยนแท็บแล้วล้างการเลือกแถว          | 1) เลือกแถว 2) คลิกสลับแท็บ (อีกปุ่มหนึ่ง)                      | มีข้อมูลอย่างน้อย 1 แถว                 | การเลือกถูกล้าง และปุ่ม “ถัดไป” กลับไป disabled                                                        |
| TC-011        | ค้นหาด้วยช่วงวันที่ (ผลลัพธ์เปลี่ยน)    | 1) เลือกวันที่ใน “ตั้งแต่/ถึง” 2) กด “ค้นหา”                    | เลือกวันที่เริ่ม/สิ้นสุดอย่างน้อย 1 ค่า | ตารางรีเฟรชตามเงื่อนไขวันที่ (request มี fromDate/toDate)                                              |
| TC-012        | ล้างค่าตัวกรอง (ผลลัพธ์กลับค่าเริ่มต้น) | 1) เลือกวันที่ 2) กด “ล้างค่า”                                  | มีวันที่เริ่มก่อนกดล้างค่า              | ช่องวันที่ถูกล้าง และตารางกลับเป็นชุดข้อมูลเริ่มต้น                                                    |

---

## การดูไฟล์ (ปุ่มไอคอนรูปตา)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ        | ขั้นตอนการทดสอบ                                                                                    | ข้อมูลการทดสอบ                            | ค่าคาดหวัง                              |
| ------------- | ----------------------- | -------------------------------------------------------------------------------------------------- | ----------------------------------------- | --------------------------------------- |
| TC-013        | เปิดไฟล์สำเร็จ (มี URL) | 1) ในแถวหนึ่ง คลิกปุ่มไอคอนดูไฟล์ (pi-eye) 2) mock `/api/v1/files/get-files` ให้คืน `files[0].url` | files[0].url = https://example.com/...pdf | เปิดดูไฟล์ pdf สำเร็จ                   |
| TC-014        | ไม่มีไฟล์               | 1) คลิกดูไฟล์ 2) mock ให้คืน `files: []`                                                           | files = []                                | เห็น toast “ไม่พบไฟล์สำหรับใบรับรองนี้” |
| TC-015        | ไฟล์ไม่มี URL           | 1) คลิกดูไฟล์ 2) mock ให้คืน `files: [{ url: null }]`                                              | files[0].url = null                       | เห็น toast “ไม่พบ URL ของไฟล์”          |
| TC-016        | ดึงไฟล์ล้มเหลว          | 1) คลิกดูไฟล์ 2) mock ให้ API ตอบ error                                                            | GET files ตอบ 500                         | เห็น toast “เกิดข้อผิดพลาดขณะดึงไฟล์”   |

---

## Step 2: ยกเลิกใบรับรอง

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                          | ขั้นตอนการทดสอบ                                                                                                                            | ข้อมูลการทดสอบ        | ค่าคาดหวัง                                                                                      |
| ------------- | ----------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | --------------------- | ----------------------------------------------------------------------------------------------- |
| TC-017        | แสดงรายละเอียดคำขอยกเลิก (อ่านอย่างเดียว) | 1) จาก Step 1 เลือกแถว 2) กด “ถัดไป”                                                                                                       | เลือกแถวแรก           | เห็น textarea “รายละเอียดคำขอยกเลิกใบรับรอง” และอยู่ในสถานะอ่านอย่างเดียว (disabled)            |
| TC-018        | ปุ่ม “ย้อนกลับ” กลับไป Step 1             | 1) อยู่ Step 2 2) กด “ย้อนกลับ”                                                                                                            | เคยเลือกแถวก่อนหน้า   | กลับ Step 1 และยังคงเลือกแถวเดิมอยู่ (ปุ่ม “ถัดไป” ยัง enabled)                                 |
| TC-019        | ยืนยันยกเลิกสำเร็จ (ลบไฟล์สำเร็จ)         | 1) อยู่ Step 2 2) mock POST `/api/v1/certificates/revoke` สำเร็จ 3) mock DELETE `/api/v1/files/delete` สำเร็จ 4) กด “ยืนยันยกเลิกใบรับรอง” | POST 200 + DELETE 200 | เห็น toast “ยกเลิกใบรับรองเรียบร้อยแล้ว” และกลับ Step 1 โดยล้างการเลือก (ปุ่ม “ถัดไป” disabled) |
| TC-020        | ยืนยันยกเลิกสำเร็จ (แต่ลบไฟล์ไม่สำเร็จ)   | 1) mock revoke สำเร็จ 2) mock delete files ตอบ error 3) กด “ยืนยันยกเลิกใบรับรอง”                                                          | POST 200 + DELETE 500 | เห็น toast “ยกเลิกใบรับรองเรียบร้อยแล้ว (แต่ไม่สามารถลบไฟล์ได้)” และกลับ Step 1                 |
| TC-021        | ยืนยันยกเลิกล้มเหลว                       | 1) mock POST `/api/v1/certificates/revoke` ตอบ error 2) กด “ยืนยันยกเลิกใบรับรอง”                                                          | POST 500              | เห็น toast “เกิดข้อผิดพลาดขณะยกเลิกใบรับรอง” และยังอยู่ที่ Step 2                               |
