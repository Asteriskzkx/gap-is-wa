# แผนการทดสอบการแก้ไขข้อมูลผู้ใช้ (Edit User)

## การเข้าถึงหน้าแก้ไขผู้ใช้

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-001        | เข้าถึงหน้าแก้ไขผ่านเมนู                      | 1. Login เป็น Admin<br>2. ไปหน้า "จัดการผู้ใช้"<br>3. คลิกปุ่ม "..." ที่แถวผู้ใช้<br>4. เลือก "Edit"               | userId = 1                            | นำทางไปหน้า /admin/user-management/edit/1                               |
| TC-002        | เข้าถึงหน้าแก้ไขโดยตรงจาก URL                 | 1. Login เป็น Admin<br>2. ไปที่ URL /admin/user-management/edit/{userId}                                           | userId = 5                            | โหลดหน้าแก้ไขพร้อมข้อมูลผู้ใช้ ID 5                                     |
| TC-003        | Loading state ขณะโหลดข้อมูล                   | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. สังเกต UI ขณะโหลด                                                                     | มี network latency                    | แสดง ProgressSpinner ขณะโหลดข้อมูล                                      |
| TC-004        | แสดง "User not found" เมื่อไม่พบผู้ใช้        | 1. ไปที่ URL /admin/user-management/edit/99999<br>2. รอโหลดเสร็จ                                                   | userId ที่ไม่มีในระบบ                 | แสดงข้อความ "User not found."                                           |
| TC-005        | Unauthorized เมื่อไม่ได้ login                | 1. ไม่ login<br>2. เข้าหน้าแก้ไขโดยตรง                                                                             | ไม่มี session                         | แสดง error หรือ redirect ไปหน้า login                                   |

## การแสดงฟอร์มตาม Role

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-006        | แสดง AdminEditForm เมื่อ role = ADMIN         | 1. เข้าหน้าแก้ไขผู้ใช้ที่มี role = ADMIN                                                                          | user.role = "ADMIN"                   | แสดงหัวข้อ "แก้ไขข้อมูลของ ผู้ดูแลระบบ" และฟอร์ม AdminEditForm          |
| TC-007        | แสดง FarmerEditForm เมื่อ role = FARMER       | 1. เข้าหน้าแก้ไขผู้ใช้ที่มี role = FARMER                                                                         | user.role = "FARMER"                  | แสดงหัวข้อ "แก้ไขข้อมูลของ เกษตรกร" และฟอร์ม FarmerEditForm             |
| TC-008        | แสดง AuditorEditForm เมื่อ role = AUDITOR     | 1. เข้าหน้าแก้ไขผู้ใช้ที่มี role = AUDITOR                                                                        | user.role = "AUDITOR"                 | แสดงหัวข้อ "แก้ไขข้อมูลของ ผู้ตรวจประเมิน" และฟอร์ม AuditorEditForm     |
| TC-009        | แสดง CommitteeEditForm เมื่อ role = COMMITTEE | 1. เข้าหน้าแก้ไขผู้ใช้ที่มี role = COMMITTEE                                                                      | user.role = "COMMITTEE"               | แสดงหัวข้อ "แก้ไขข้อมูลของ คณะกรรมการ" และฟอร์ม CommitteeEditForm       |
| TC-010        | แสดง BasicEditForm เมื่อ role = BASIC         | 1. เข้าหน้าแก้ไขผู้ใช้ที่มี role = BASIC                                                                          | user.role = "BASIC"                   | แสดงฟอร์ม BasicEditForm                                                 |

## การโหลดข้อมูลเดิม (Pre-populate Form)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-011        | โหลดคำนำหน้าชื่อ                              | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ตรวจสอบ dropdown "คำนำหน้า"                                                           | user.admin.namePrefix = "นาย"         | Dropdown แสดงค่า "นาย"                                                  |
| TC-012        | โหลดชื่อ                                      | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ตรวจสอบช่อง "ชื่อ"                                                                    | user.admin.firstName = "สมชาย"        | Input แสดงค่า "สมชาย"                                                   |
| TC-013        | โหลดนามสกุล                                   | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ตรวจสอบช่อง "นามสกุล"                                                                 | user.admin.lastName = "ใจดี"          | Input แสดงค่า "ใจดี"                                                    |
| TC-014        | โหลดอีเมล                                     | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ตรวจสอบช่อง "อีเมล"                                                                   | user.email = "test@email.com"         | Input แสดงค่า "test@email.com"                                          |
| TC-015        | แสดงข้อมูลผู้ใช้ที่กำลังแก้ไข                 | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ตรวจสอบข้อความแสดงตัวตน                                                               | user.admin.firstName = "สมชาย"        | แสดง "คุณกำลังแก้ไขข้อมูลผู้ใช้ชื่อ นายสมชาย ใจดี ( รหัสผู้ใช้ : X )"   |
| TC-016        | แสดง "-" เมื่อไม่มีชื่อ                       | 1. เข้าหน้าแก้ไขผู้ใช้ที่ไม่มีชื่อ                                                                                 | firstName และ lastName เป็นค่าว่าง   | แสดง "คุณกำลังแก้ไขข้อมูลผู้ใช้ชื่อ - ( รหัสผู้ใช้ : X )"               |

## การแก้ไขข้อมูลในฟอร์ม

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-017        | แก้ไขคำนำหน้าชื่อ                             | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. เปลี่ยน dropdown "คำนำหน้า" เป็น "นางสาว"                                             | เลือก "นางสาว"                        | ค่า namePrefix ถูกอัปเดตเป็น "นางสาว"                                   |
| TC-018        | แก้ไขชื่อ                                     | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขช่อง "ชื่อ" เป็น "สมหญิง"                                                        | กรอก "สมหญิง"                         | ค่า firstName ถูกอัปเดตเป็น "สมหญิง"                                    |
| TC-019        | แก้ไขนามสกุล                                  | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขช่อง "นามสกุล" เป็น "รักดี"                                                      | กรอก "รักดี"                          | ค่า lastName ถูกอัปเดตเป็น "รักดี"                                      |
| TC-020        | แก้ไขอีเมล                                    | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขช่อง "อีเมล" เป็น "new@email.com"                                                | กรอก "new@email.com"                  | ค่า email ถูกอัปเดตเป็น "new@email.com"                                 |
| TC-021        | จำกัดความยาวชื่อไม่เกิน 100 ตัวอักษร          | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. กรอกชื่อยาวเกิน 100 ตัวอักษร                                                          | ชื่อยาว 150 ตัวอักษร                  | Input จำกัดความยาวไว้ที่ 100 ตัวอักษร                                   |

## การตรวจจับการเปลี่ยนแปลง (Dirty State)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-022        | ไม่มีการเปลี่ยนแปลง (isDirty = false)         | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ไม่แก้ไขข้อมูลใดๆ<br>3. ตรวจสอบ state                                                 | ไม่มีการแก้ไข                         | isDirty = false และปุ่ม "รีเซ็ต" ไม่มีการเปลี่ยนแปลงที่ต้องรีเซ็ต      |
| TC-023        | มีการเปลี่ยนแปลง (isDirty = true)             | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขชื่อ<br>3. ตรวจสอบ state                                                         | แก้ไข firstName                       | isDirty = true                                                          |
| TC-024        | รีเซ็ตฟอร์มกลับค่าเดิม                        | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขข้อมูลหลายช่อง<br>3. กดปุ่ม "รีเซ็ต"                                             | แก้ไขหลายค่า                          | ข้อมูลทั้งหมดกลับเป็นค่าเดิม และ isDirty = false                        |

## การบันทึกข้อมูล

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-025        | บันทึกข้อมูลสำเร็จ                            | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขชื่อ<br>3. กดปุ่ม "บันทึก"                                                       | แก้ไข firstName เป็น "สมหญิง"         | แสดง toast "บันทึกข้อมูลเรียบร้อย" และข้อมูลถูกบันทึก                   |
| TC-026        | ส่ง version ใน payload (Optimistic Lock)      | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขข้อมูล<br>3. กดปุ่ม "บันทึก"<br>4. ตรวจสอบ request payload                       | version = 2                           | payload มี version สำหรับ optimistic locking                            |
| TC-027        | อัปเดต state หลังบันทึกสำเร็จ                 | 1. บันทึกข้อมูลสำเร็จ<br>2. ตรวจสอบ user state                                                                     | บันทึกสำเร็จ                          | user state ถูกอัปเดตด้วยข้อมูลใหม่รวมถึง version ใหม่                   |
| TC-028        | Loading state ขณะบันทึก                       | 1. กดปุ่ม "บันทึก"<br>2. สังเกต UI ขณะบันทึก                                                                       | มี network latency                    | ปุ่มบันทึก disabled และแสดง submitting state                            |
| TC-029        | ปุ่ม "บันทึก" disabled ขณะ submitting         | 1. กดปุ่ม "บันทึก"<br>2. พยายามกดปุ่มอีกครั้งขณะกำลังบันทึก                                                        | submitting = true                     | ไม่สามารถกดปุ่มซ้ำได้                                                   |

## การจัดการ Error

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-030        | บันทึกไม่สำเร็จ (Network error)               | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ปิด network<br>3. กดปุ่ม "บันทึก"                                                     | จำลอง network error                   | แสดง toast error "บันทึกไม่สำเร็จ"                                      |
| TC-031        | บันทึกไม่สำเร็จ (Server error)                | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. แก้ไขข้อมูล<br>3. กดปุ่ม "บันทึก"<br>4. Server return 500                             | Server return status 500              | แสดง toast error พร้อมข้อความจาก server                                 |
| TC-032        | Version conflict (Optimistic Lock Error)      | 1. เปิด 2 หน้าต่างแก้ไขผู้ใช้คนเดียวกัน<br>2. หน้า A บันทึกก่อน<br>3. หน้า B บันทึกด้วย version เดิม               | version ไม่ตรง                        | แสดง toast error "ข้อมูลถูกแก้ไขโดยผู้ใช้อื่น กรุณาโหลดใหม่"            |
| TC-033        | แสดง error message จาก API                    | 1. กดบันทึก<br>2. API return error พร้อม message                                                                   | API return { message: "อีเมลซ้ำ" }    | แสดง toast error "อีเมลซ้ำ"                                             |
| TC-034        | Database connection error                     | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. Database ไม่สามารถเชื่อมต่อได้<br>3. กดปุ่ม "บันทึก"                                  | Database offline                      | แสดง toast error "ไม่สามารถเชื่อมต่อฐานข้อมูล"                          |

## Validation

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-035        | คำนำหน้าชื่อเป็น required                     | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ล้างค่า dropdown "คำนำหน้า"<br>3. กดปุ่ม "บันทึก"                                     | namePrefix = ""                       | แสดง validation error / ไม่สามารถ submit ได้                            |
| TC-036        | ชื่อเป็น required                             | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ล้างช่อง "ชื่อ"<br>3. กดปุ่ม "บันทึก"                                                 | firstName = ""                        | แสดง validation error / ไม่สามารถ submit ได้                            |
| TC-037        | นามสกุลเป็น required                          | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ล้างช่อง "นามสกุล"<br>3. กดปุ่ม "บันทึก"                                              | lastName = ""                         | แสดง validation error / ไม่สามารถ submit ได้                            |
| TC-038        | อีเมลเป็น required                            | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. ล้างช่อง "อีเมล"<br>3. กดปุ่ม "บันทึก"                                                | email = ""                            | แสดง validation error / ไม่สามารถ submit ได้                            |
| TC-039        | รูปแบบอีเมลไม่ถูกต้อง                         | 1. เข้าหน้าแก้ไขผู้ใช้<br>2. กรอกอีเมลไม่ถูกรูปแบบ<br>3. กดปุ่ม "บันทึก"                                           | email = "invalid-email"               | แสดง validation error รูปแบบอีเมลไม่ถูกต้อง                             |

## การแก้ไขข้อมูลตาม Role เฉพาะ

### Admin

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-040        | เรียก API PUT /api/v1/admins/{adminId}        | 1. เข้าหน้าแก้ไข Admin<br>2. แก้ไขข้อมูล<br>3. กดปุ่ม "บันทึก"<br>4. ตรวจสอบ network request                       | แก้ไข Admin                           | เรียก PUT /api/v1/admins/{adminId}                                      |
| TC-041        | Payload ถูกต้องสำหรับ Admin                   | 1. เข้าหน้าแก้ไข Admin<br>2. กดปุ่ม "บันทึก"<br>3. ตรวจสอบ request payload                                         | แก้ไข Admin                           | payload มี namePrefix, firstName, lastName, email, version             |

### Farmer

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-042        | เรียก API PUT /api/v1/farmers/{farmerId}      | 1. เข้าหน้าแก้ไข Farmer<br>2. แก้ไขข้อมูล<br>3. กดปุ่ม "บันทึก"<br>4. ตรวจสอบ network request                      | แก้ไข Farmer                          | เรียก PUT /api/v1/farmers/{farmerId}                                    |
| TC-043        | แสดงฟิลด์เพิ่มเติมสำหรับ Farmer               | 1. เข้าหน้าแก้ไข Farmer<br>2. ตรวจสอบฟอร์ม                                                                         | user.role = "FARMER"                  | แสดงฟิลด์เพิ่มเติมเช่น ที่อยู่, เลขบัตรประชาชน ฯลฯ                      |

### Auditor

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-044        | เรียก API PUT /api/v1/auditors/{auditorId}    | 1. เข้าหน้าแก้ไข Auditor<br>2. แก้ไขข้อมูล<br>3. กดปุ่ม "บันทึก"<br>4. ตรวจสอบ network request                     | แก้ไข Auditor                         | เรียก PUT /api/v1/auditors/{auditorId}                                  |

### Committee

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-045        | เรียก API PUT /api/v1/committees/{committeeId}| 1. เข้าหน้าแก้ไข Committee<br>2. แก้ไขข้อมูล<br>3. กดปุ่ม "บันทึก"<br>4. ตรวจสอบ network request                   | แก้ไข Committee                       | เรียก PUT /api/v1/committees/{committeeId}                              |

## การอัปเดต State หลังบันทึก

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-046        | อัปเดต user.admin หลังบันทึก Admin            | 1. บันทึก Admin สำเร็จ<br>2. ตรวจสอบ user state                                                                    | บันทึก Admin สำเร็จ                   | user.admin ถูกอัปเดตด้วยข้อมูลใหม่                                      |
| TC-047        | อัปเดต user.email หลังบันทึก                  | 1. แก้ไขอีเมล<br>2. บันทึกสำเร็จ<br>3. ตรวจสอบ user.email                                                          | แก้ไข email                           | user.email ถูกอัปเดตเป็นค่าใหม่                                         |
| TC-048        | อัปเดต version หลังบันทึก                     | 1. บันทึกสำเร็จ<br>2. ตรวจสอบ version                                                                              | version เดิม = 2                      | version ใหม่ = 3 (เพิ่มขึ้น 1)                                          |
| TC-049        | ฟอร์มไม่ dirty หลังบันทึกสำเร็จ               | 1. แก้ไขข้อมูล<br>2. บันทึกสำเร็จ<br>3. ตรวจสอบ isDirty                                                            | บันทึกสำเร็จ                          | ฟอร์ม defaultValues ถูกอัปเดตเป็นค่าใหม่ และ isDirty = false            |

## กรณีทดสอบ Edge Case

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                              | ขั้นตอนการทดสอบ                                                                                                    | ข้อมูลการทดสอบ                        | ค่าคาดหวัง                                                              |
| ------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------- | ----------------------------------------------------------------------- |
| TC-050        | userId ไม่ใช่ตัวเลข                           | 1. ไปที่ URL /admin/user-management/edit/abc                                                                       | id = "abc"                            | แสดง loading spinner หรือ error handling                                |
| TC-051        | userId เป็น negative number                   | 1. ไปที่ URL /admin/user-management/edit/-1                                                                        | id = "-1"                             | แสดง "User not found" หรือ error handling                               |
| TC-052        | userId เป็น 0                                 | 1. ไปที่ URL /admin/user-management/edit/0                                                                         | id = "0"                              | แสดง "User not found" หรือ error handling                               |
| TC-053        | แก้ไขข้อมูลที่มีอักขระพิเศษ                   | 1. กรอกชื่อที่มีอักขระพิเศษ เช่น "<script>"<br>2. กดบันทึก                                                         | firstName = "<script>alert(1)</script>" | ข้อมูลถูก sanitize หรือ escape ก่อนบันทึก                              |
| TC-054        | Concurrent edit detection                     | 1. เปิดหน้าแก้ไขผู้ใช้ 2 หน้าต่าง<br>2. หน้าต่าง A บันทึก<br>3. หน้าต่าง B บันทึก                                  | 2 session แก้ไขพร้อมกัน               | หน้าต่าง B แสดง error version conflict                                  |
| TC-055        | กดปุ่มบันทึกซ้ำเร็วๆ                          | 1. กดปุ่ม "บันทึก" หลายครั้งติดต่อกันอย่างรวดเร็ว                                                                  | คลิกเร็วๆ 5 ครั้ง                     | เรียก API เพียงครั้งเดียว (ป้องกัน double submit)                       |
