# แผนการทดสอบการสรุปผลการตรวจประเมินสวนยางพารา (Playwright E2E Testing)

เอกสารนี้คงไว้เฉพาะกรณีที่ทดสอบได้จริงด้วย Playwright แบบ End-to-End โดยอิง UI จาก 3 หน้า:

- `src/app/auditor/reports/page.tsx` (ใช้ `InspectionReports`)
- `src/app/auditor/inspection-summary/[id]/page.tsx` (ใช้ `InspectionSummaryContent`)
- `src/app/auditor/inspection-detail/[id]/[itemId]/page.tsx` (ใช้ `InspectionDetailContent`)

**ขอบเขต**

- ตรวจเฉพาะสิ่งที่ผู้ใช้มองเห็น/โต้ตอบได้: ข้อความบนจอ, ปุ่ม, สถานะ enabled/disabled, การนำทาง (URL), toast
- แนะนำให้ทำให้เทส deterministic ด้วยการ mock API ผ่าน `page.route`
- ไม่ตรวจ: สี/คลาส CSS, console log, payload/body, DB state

**API ที่เกี่ยวข้อง (แนะนำ mock ด้วย `page.route`)**

- Reports list: GET `/api/v1/inspections?limit=...&offset=...&inspectionStatus=...&inspectionResult=...&province=...&district=...&subDistrict=...&multiSortMeta=...`
- Summary: GET `/api/v1/inspections/:inspectionId`, GET `/api/v1/inspection-items?inspectionId=...`, PUT `/api/v1/inspections/:inspectionId/result`
- Detail: GET `/api/v1/inspections/:inspectionId`, GET `/api/v1/inspection-items?inspectionId=...`

---

## 1) หน้ารายการสรุปผล (`/auditor/reports`)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                   | ขั้นตอนการทดสอบ                                                                 | ค่าคาดหวัง                                                                                                 |
| ------------- | -------------------------------------------------- | ------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| TC-001        | ต้อง login ก่อนเข้าใช้งาน                          | 1) เปิด `/auditor/reports` โดยไม่มี session                                     | ระบบ redirect ไปหน้า `/`                                                                                   |
| TC-002        | แสดงหัวข้อ/คำอธิบาย และปุ่มแท็บ                    | 1) Login แล้วเปิดหน้า                                                           | เห็น “สรุปผลการตรวจประเมิน”, “จัดการและสรุปผลการตรวจประเมินสวนยางพารา” และปุ่มแท็บ “รอสรุปผล”, “เสร็จสิ้น” |
| TC-003        | ค่าเริ่มต้นแท็บ “รอสรุปผล” + empty message ถูกต้อง | 1) เปิดหน้า 2) mock ให้รายการว่าง                                               | เห็น empty message “ไม่พบรายการตรวจประเมินที่รอสรุปผล”                                                     |
| TC-004        | สลับแท็บเป็น “เสร็จสิ้น” + empty message ถูกต้อง   | 1) กดแท็บ “เสร็จสิ้น” 2) mock ให้รายการว่าง                                     | เห็น empty message “ไม่พบรายการตรวจประเมินที่เสร็จสิ้น”                                                    |
| TC-005        | ตัวกรองพื้นที่ enable/disable ตามลำดับชั้น         | 1) เปิดหน้า                                                                     | “อำเภอ/เขต” disabled ก่อนเลือก “จังหวัด”; “ตำบล/แขวง” disabled ก่อนเลือก “อำเภอ/เขต”                       |
| TC-006        | กด “ล้างค่า” รีเซ็ตตัวกรอง                         | 1) เลือก จังหวัด/อำเภอ/ตำบล 2) กด “ล้างค่า”                                     | ค่าตัวกรองถูกล้าง และผลลัพธ์ในตารางกลับชุดเริ่มต้นตามที่ mock                                              |
| TC-007        | แสดงคอลัมน์หลักของตาราง                            | 1) mock ให้มีข้อมูลอย่างน้อย 1 แถว                                              | เห็นหัวคอลัมน์: “รหัสการตรวจ”, “เกษตรกร”, “สถานที่”, “วันที่ตรวจ”, “สถานะ”, “จัดการ”                       |
| TC-008        | กดปุ่ม “จัดการ” แล้วไปหน้าสรุปผล                   | 1) mock ให้มีข้อมูล 1 แถว 2) กดปุ่มในคอลัมน์ “จัดการ”                           | URL เปลี่ยนเป็น `/auditor/inspection-summary/{inspectionId}`                                               |
| TC-009        | แสดง fallback ของข้อมูลบางช่อง                     | 1) mock ให้แถวหนึ่งมี `rubberFarm.farmer=null` และข้อมูลสถานที่ว่าง 2) เปิดหน้า | คอลัมน์ “เกษตรกร” แสดง “ไม่มีข้อมูล” และคอลัมน์ “สถานที่” แสดง “-”                                         |

---

## 2) หน้าสรุปผลการตรวจ (`/auditor/inspection-summary/:id`)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                        | ขั้นตอนการทดสอบ                                                                                                                                    | ค่าคาดหวัง                                                                                                                                                   |
| ------------- | ------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| TC-010        | ต้อง login ก่อนเข้าใช้งาน                               | 1) เปิด `/auditor/inspection-summary/1` โดยไม่มี session                                                                                           | ระบบ redirect ไปหน้า `/`                                                                                                                                     |
| TC-011        | แสดงหัวข้อ/คำอธิบาย และหัวข้อ section หลัก              | 1) mock ให้โหลดได้ปกติ 2) เปิดหน้า                                                                                                                 | เห็น “สรุปผลการตรวจประเมิน”, “กรุณาตรวจสอบข้อมูลและสรุปผลการประเมินสวนยางพารา”, “ข้อมูลทั่วไป”, “ผลการตรวจประเมินรายหัวข้อ”, “สรุปผลการตรวจประเมิน”          |
| TC-012        | ตาราง “ผลการตรวจประเมินรายหัวข้อ” และนำทางไปหน้า detail | 1) mock ให้มีอย่างน้อย 1 item 2) ตรวจหัวคอลัมน์ 3) กดไอคอนดูรายละเอียด (pi-eye) ของแถวหนึ่ง                                                        | เห็นหัวคอลัมน์ “ลำดับ”, “รายการตรวจประเมิน”, “ผลการประเมิน”, “รายละเอียด”; เมื่อกดแล้ว URL ไป `/auditor/inspection-detail/{inspectionId}/{inspectionItemId}` |
| TC-013        | กรณี completed: ซ่อนปุ่มบันทึกและปุ่มซ้ายเป็น “กลับ”    | 1) mock ให้ `inspection.inspectionResult` ไม่เท่ากับ “รอผลการตรวจประเมิน” 2) เปิดหน้า                                                              | เห็นปุ่ม “กลับ” และไม่เห็นปุ่ม “บันทึกผลการประเมิน”                                                                                                          |
| TC-014        | กรณี pending: บันทึกผลสำเร็จและกลับหน้า reports         | 1) mock ให้ `inspection.inspectionResult` = “รอผลการตรวจประเมิน” 2) mock PUT `/api/v1/inspections/:id/result` ให้สำเร็จ 3) กด “บันทึกผลการประเมิน” | เห็น toast “บันทึกผลการประเมินเรียบร้อยแล้ว” และนำทางกลับ `/auditor/reports`                                                                                 |
| TC-015        | กรณี pending: บันทึกไม่สำเร็จ                           | 1) mock ให้ pending 2) mock PUT ให้ error พร้อม message หรือไม่ส่ง ok 3) กด “บันทึกผลการประเมิน”                                                   | เห็น toast “ไม่สามารถบันทึกผลการประเมินได้ กรุณาลองใหม่อีกครั้ง” หรือ `errorData.message` ตามที่ mock                                                        |
| TC-016        | กรณี pending: บันทึกชนกัน (409 conflict)                | 1) mock ให้ pending 2) mock PUT `/api/v1/inspections/:id/result` ให้ตอบ 409 และมี `userMessage` (หรือไม่มีก็ได้) 3) กด “บันทึกผลการประเมิน”        | เห็น toast “ข้อมูลถูกแก้ไขโดยผู้ใช้อื่นแล้ว กรุณาโหลดข้อมูลใหม่และลองอีกครั้ง” (หรือ `userMessage` ตามที่ mock) และหน้า reload                               |
| TC-017        | กรณี pending: error ระดับ network/exception             | 1) mock ให้ pending 2) ทำให้ PUT โยน exception/ตัดการเชื่อมต่อ 3) กด “บันทึกผลการประเมิน”                                                          | เห็น toast “เกิดข้อผิดพลาดในการบันทึกผลการประเมิน”                                                                                                           |

---

## 3) หน้ารายละเอียดรายการตรวจ (`/auditor/inspection-detail/:id/:itemId`)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                      | ขั้นตอนการทดสอบ                                                           | ค่าคาดหวัง                                                                                                                                            |
| ------------- | ----------------------------------------------------- | ------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| TC-018        | ต้อง login ก่อนเข้าใช้งาน                             | 1) เปิด `/auditor/inspection-detail/1/1` โดยไม่มี session                 | ระบบ redirect ไปหน้า `/`                                                                                                                              |
| TC-019        | แสดงหัวข้อและข้อมูลสรุปการตรวจ                        | 1) mock ให้โหลดได้ปกติ 2) เปิดหน้า                                        | เห็นหัวข้อ “รายละเอียดการตรวจประเมิน” และ label: “รหัสการตรวจประเมิน”, “วันที่นัดหมาย”, “ประเภทการตรวจ”, “พื้นที่สวนยาง”                              |
| TC-020        | แสดงหัวข้อรายการ + ส่วนข้อกำหนด (หรือ empty)          | 1) mock ให้มี inspectionItem 2) เปิดหน้า                                  | เห็น “รายการที่ {inspectionItemNo} : {itemName}”; ถ้ามี requirements เห็นหัวข้อ “ข้อกำหนด”; ถ้าไม่มี requirements เห็น “ไม่พบข้อกำหนดสำหรับรายการนี้” |
| TC-021        | แสดง “ข้อมูลเพิ่มเติม” ตามประเภท item (ตัวอย่าง: น้ำ) | 1) mock ให้ itemName = “น้ำ” และมี otherConditions ตามต้องการ 2) เปิดหน้า | เห็น “ข้อมูลเพิ่มเติม”, “แหล่งน้ำที่ใช้ในแปลงปลูก”, “น้ำที่ใช้ในการหลังการเก็บเกี่ยว”                                                                 |
| TC-022        | ปุ่มกลับไปหน้าสรุปผล                                  | 1) เข้าหน้านี้จากหน้า summary 2) กด “กลับไปหน้าสรุปผล”                    | กลับไปหน้า `/auditor/inspection-summary/{inspectionId}` (หรือย้อนกลับตาม history)                                                                     |
