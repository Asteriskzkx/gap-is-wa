# แผนการทดสอบ (Playwright E2E) — ตรวจสอบเหตุการณ์ในระบบ (Audit Logs)

เอกสารนี้คงไว้เฉพาะกรณีที่ทดสอบได้จริงด้วย Playwright แบบ End-to-End โดยอิง UI จากหน้า `src/app/admin/audit-logs/page.tsx` และพฤติกรรม fetch/filter จาก `src/hooks/useAdminAuditLogs.ts`

**ขอบเขต**

- ตรวจเฉพาะสิ่งที่ผู้ใช้มองเห็น/โต้ตอบได้: ข้อความบนจอ, dialog, ปุ่ม enabled/disabled, toast, ตารางเปลี่ยนตามผลลัพธ์ที่ mock
- ไม่ตรวจ: สี/คลาส CSS, console log, payload/body, DB state, ความถูกต้องของ query string (ให้ใช้การ mock เพื่อกำหนดผลลัพธ์แทน)

**API ที่เกี่ยวข้อง (แนะนำ mock ด้วย `page.route`)**

- GET `/api/v1/audit-logs/paginated?...`
- GET `/api/v1/audit-logs/old/count?days=...`
- DELETE `/api/v1/audit-logs/old?days=...`

---

## การเข้าถึงหน้า

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ          | ขั้นตอนการทดสอบ                                  | ค่าคาดหวัง                                                                      |
| ------------- | ------------------------- | ------------------------------------------------ | ------------------------------------------------------------------------------- |
| TC-001        | ต้อง login ก่อนเข้าใช้งาน | 1) เปิดหน้า `/admin/audit-logs` โดยไม่มี session | ระบบ redirect ไปหน้า `/`                                                        |
| TC-002        | แสดงหัวข้อและคำอธิบายหน้า | 1) Login แล้วเปิดหน้า                            | เห็น “ตรวจสอบเหตุการณ์ในระบบ” และ “ตรวจสอบความเคลื่อนไหวและกิจกรรมต่างๆ ในระบบ” |

---

## ตัวกรองและตารางรายการ

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                     | ขั้นตอนการทดสอบ                                                                                             | ค่าคาดหวัง                                                                                                                                                                                                                            |
| ------------- | ---------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| TC-003        | แสดงตัวกรองทั้งหมด                                   | 1) เปิดหน้า                                                                                                 | เห็นตัวกรอง: “ตาราง”, “รหัสข้อมูลในตาราง”, “รหัสผู้ใช้”, “การดำเนินการ”, “วันที่เริ่มต้น”, “วันที่สิ้นสุด” และ placeholder “เลือกตาราง/ระบุรหัสข้อมูลในตาราง/ระบุรหัสผู้ใช้/เลือกการดำเนินการ/เลือกวันที่เริ่มต้น/เลือกวันที่สิ้นสุด” |
| TC-004        | แสดงปุ่มหลักบนแถบตัวกรอง                             | 1) เปิดหน้า                                                                                                 | เห็นปุ่ม “ล้างข้อมูลเก่า”, “ค้นหา”, “ล้างตัวกรอง”                                                                                                                                                                                     |
| TC-005        | แสดงตารางพร้อมคอลัมน์หลัก                            | 1) เปิดหน้า (mock ให้มีข้อมูลอย่างน้อย 1 แถว)                                                               | เห็นหัวคอลัมน์: “รหัส”, “ตาราง”, “การดำเนินการ”, “รหัสข้อมูลในตาราง”, “รหัสผู้ใช้”, “วันที่ดำเนินการ”                                                                                                                                 |
| TC-006        | แสดง mapping ของ “ตาราง/การดำเนินการ” เป็นข้อความไทย | 1) mock ให้มี log ที่ `tableName=User` และ `action=CREATE`                                                  | ในตารางแสดง “ผู้ใช้ (User)” และ “เพิ่มข้อมูล (CREATE)”                                                                                                                                                                                |
| TC-007        | กด “ค้นหา” แล้วผลลัพธ์เปลี่ยนตามที่ mock             | 1) ตั้งค่า filter อย่างน้อย 1 ตัว (เช่น “ตาราง” หรือ “การดำเนินการ”) 2) mock response ชุดใหม่ 3) กด “ค้นหา” | ตารางเปลี่ยนเป็นชุดข้อมูลตามที่ mock ไว้                                                                                                                                                                                              |
| TC-008        | กด “ล้างตัวกรอง” แล้วกลับค่าเริ่มต้น                 | 1) ตั้งค่า filter หลายตัว 2) กด “ล้างตัวกรอง” 3) mock ให้ response กลับเป็นชุดเริ่มต้น                      | ค่าตัวกรองถูกล้าง และตารางกลับเป็นชุดข้อมูลเริ่มต้น                                                                                                                                                                                   |
| TC-009        | Pagination: เปลี่ยนจำนวนรายการต่อหน้า                | 1) เลือก rows เป็น 25 (mock ให้ชุดข้อมูลต่างจาก 10)                                                         | ตารางอัปเดตตามชุดข้อมูลที่ mock ไว้                                                                                                                                                                                                   |
| TC-010        | Pagination: เปลี่ยนหน้า                              | 1) ไปหน้าถัดไป (mock ให้ response หน้าถัดไปต่างกัน)                                                         | ตารางเปลี่ยนเป็นรายการหน้าถัดไป                                                                                                                                                                                                       |
| TC-011        | Sorting: คลิกหัวคอลัมน์ให้ลำดับเปลี่ยน               | 1) คลิกหัวคอลัมน์ “รหัส” หรือ “วันที่ดำเนินการ” (mock ให้ response เปลี่ยนตาม sort)                         | ตารางเปลี่ยนลำดับตามที่ mock ไว้                                                                                                                                                                                                      |

---

## ดูรายละเอียดบันทึกเหตุการณ์ (ไอคอนรูปตา)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                                      | ขั้นตอนการทดสอบ                                                         | ค่าคาดหวัง                                                                                                                       |
| ------------- | ----------------------------------------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| TC-012        | เปิด dialog รายละเอียดได้                             | 1) คลิกปุ่มไอคอนดูรายละเอียด (pi-eye) ในแถวหนึ่ง                        | เห็น dialog หัวข้อ “รายละเอียดบันทึกเหตุการณ์” และปุ่ม “ปิด”                                                                     |
| TC-013        | แสดงข้อมูลพื้นฐานใน dialog                            | 1) เปิด dialog รายละเอียด                                               | เห็น section “ข้อมูลพื้นฐาน” และค่า “รหัส/ตาราง/การดำเนินการ/รหัสข้อมูลในตาราง/รหัสผู้ใช้/วันที่ดำเนินการ” ตามข้อมูลที่ mock ไว้ |
| TC-014        | แสดง “ไม่มีข้อมูลเก่า/ไม่มีข้อมูลใหม่” เมื่อเป็น null | 1) mock ให้ `oldData=null` และ `newData=null` 2) เปิด dialog รายละเอียด | เห็นข้อความ “ไม่มีข้อมูลเก่า” และ “ไม่มีข้อมูลใหม่”                                                                              |
| TC-015        | ปิด dialog รายละเอียด                                 | 1) กดปุ่ม “ปิด”                                                         | dialog ปิดลง                                                                                                                     |

---

## ล้างข้อมูลเก่า (Delete old logs)

| รหัสกรณีทดสอบ | ชื่อกรณีการทดสอบ                  | ขั้นตอนการทดสอบ                                                                                                                                              | ค่าคาดหวัง                                                                                                 |
| ------------- | --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------- |
| TC-016        | เปิด dialog “ล้างข้อมูลเก่า”      | 1) กดปุ่ม “ล้างข้อมูลเก่า” 2) mock `/api/v1/audit-logs/old/count?days=90`                                                                                    | เห็น dialog หัวข้อ “ล้างข้อมูลเก่า”, ข้อความคำเตือน และช่อง “ลบข้อมูลที่เก่ากว่า (วัน)”                    |
| TC-017        | ไม่พบข้อมูลที่จะลบ (count = 0)    | 1) เปิด dialog 2) mock count=0                                                                                                                               | เห็นข้อความ “ไม่พบข้อมูลที่เก่ากว่า 90 วัน” และปุ่ม “ยืนยันการลบ” disabled                                 |
| TC-018        | ยืนยันลบสำเร็จ (มีข้อมูลให้ลบ)    | 1) เปิด dialog 2) mock count>0 ให้แสดง “จำนวนที่จะถูกลบ” 3) mock DELETE `/api/v1/audit-logs/old?days=...` ให้สำเร็จและส่ง `deletedCount` 4) กด “ยืนยันการลบ” | เห็น toast `ลบข้อมูลเก่าที่เก่ากว่า {days} วันสำเร็จ (ลบไปทั้งหมด {deletedCount} รายการ)` และ dialog ปิดลง |
| TC-019        | ยืนยันลบไม่สำเร็จ (API ตอบ error) | 1) mock count>0 2) mock DELETE ให้ error หรือให้ hook คืน success=false 3) กด “ยืนยันการลบ”                                                                  | เห็น toast “ไม่สามารถลบข้อมูลได้” หรือ “เกิดข้อผิดพลาดในการลบข้อมูล” ตามกรณีที่ mock ไว้                   |
